{"version":3,"sources":["app/familyChart/view/elements/Form.js","app/familyChart/d3.js","app/familyChart/CalculateTree/CalculateTree.handlers.js","app/familyChart/handlers/general.js","app/familyChart/handlers/newPerson.js","app/familyChart/CalculateTree/CalculateTree.js","app/familyChart/createStore.js","app/familyChart/FamilyChartActions.js","App.js","index.js"],"names":["Form","_ref","datum","rel_datum","store","rel_type","card_edit","postSubmit","card_display","_ref$edit","edit","el","open","close","submitFormChanges","e","preventDefault","FormData","target","forEach","v","k","data","deletePerson","delete","innerHTML","concat","to_add","gender","map","d","type","key","placeholder","join","getEditFields","data_stash","getData","rels","spouses","length","sp_id","i","spouse","find","id","otherParentSelect","querySelector","addEventListener","window","d3","_d3","otherParent","p1","d0","mother","father","generateUUID","Date","getTime","d2","performance","now","replace","c","r","Math","random","floor","toString","createNewPerson","_ref2","CalculateTree","_ref$main_id","main_id","_ref$is_vertical","is_vertical","_ref$node_separation","node_separation","_ref$level_separation","level_separation","to_add_spouses","_loop2","children","is_father","child","d1","push","createToAddSpouse","createRelsToAdd","sort","a","b","a_d","b_d","a_p2","b_p2","a_i","indexOf","b_i","main","tree_children","calculateTreePositions","tree_parents","parents","mid_diff","x","levelOutEachSide","tree","is_ancestry","depth","parent","_toConsumableArray","slice","_ref4","setupChildrenAndParents","_ref3","_loop","side","added","y","sx","psx","p2","midd","sp","setupSpouses","d_x","nodePositioning","dim","_ref5","w_extent","extent","h_extent","width","height","x_off","y_off","calculateTreeDim","rt","hierarchyGetter","filter","d3_tree","nodeSize","separation","offset","sameParent","hasSpouses","someSpouses","max","offsetOnPartners","sameBothParents","root","hierarchy","descendants","require","createStore","initial_state","onUpdate","state","update","props","console","log","localStorage","setItem","JSON","stringify","mainId","getTree","setOnUpdate","f","methods","FamilyTree","_React$Component","_inherits","_super","_createSuper","_this","_classCallCheck","call","chartRef","React","createRef","contRef","handleF3","bind","_assertThisInitialized","chartState","_createClass","value","this","current","dataTree","dataJson","getItem","parse","cont","document","card_dim","w","h","text_x","text_y","img_w","img_h","img_x","img_y","create_form","cardDisplay","label","desc","mini_tree","hide_rels","custom_elements","customAddBtn","lis","customAddBtnListener","query","view","f3","d3AnimationView","Card","elements","svg","cardEditForm","addRelative","handlers","AddRelative","labels","link_break","ps_props","modal","M","Modal","getInstance","_objectSpread","setCard","initial","body","appendChild","createElement","setAttribute","init","initProcess","getElementById","chartInstance","style","display","justifyContent","maxWidth","margin","className","ref","position","Component","card","App","rootElement","ReactDOM","render","StrictMode"],"mappings":"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","file":"static/js/main.1032a30d.chunk.js","sourcesContent":["import _ from \"lodash\";\r\n\r\nexport function Form({datum, rel_datum, store, rel_type, card_edit, postSubmit, card_display, edit: {el, open, close}}) {\r\n  setupFromHtml();\r\n  open();\r\n\r\n\r\n  function setupFromHtml() {\r\n    el.innerHTML = (`\r\n      <div class=\"modal-content\">\r\n        <form>\r\n          <div>\r\n            <div style=\"text-align: left\">\r\n              <span style=\"display: ${datum.to_add || !!rel_datum ? 'none' : null}; float: right; cursor: pointer\" class=\"red-text delete\">delete</span>\r\n            </div>\r\n            <div>\r\n              <label><input type=\"radio\" name=\"gender\" value=\"M\" ${datum.data.gender === 'M' ? 'checked' : ''}><span>male</span></label><br>\r\n              <label><input type=\"radio\" name=\"gender\" value=\"F\" ${datum.data.gender === 'F' ? 'checked' : ''}><span>female</span></label><br>\r\n            </div>\r\n          </div>\r\n          ${getEditFields(card_edit)}\r\n          ${(rel_type === \"son\" || rel_type === \"daughter\") ? otherParentSelect() : ''}\r\n          <br><br>\r\n          <div style=\"text-align: center\">\r\n            <button type=\"submit\" class=\"btn\">submit</button>\r\n          </div>\r\n        </form>\r\n      </div>\r\n    `)\r\n    el.querySelector(\"form\").addEventListener('submit', submitFormChanges)\r\n    el.querySelector(\".delete\").addEventListener('click', deletePerson)\r\n  }\r\n\r\n  function otherParentSelect() {\r\n    const data_stash = store.getData();\r\n    return (`\r\n      <div>\r\n        <label>Select other</label>\r\n        <select name=\"other_parent\" style=\"display: block\">\r\n          ${(!rel_datum.rels.spouses || rel_datum.rels.spouses.length === 0) \r\n              ? '' \r\n              : rel_datum.rels.spouses.map((sp_id, i) => {\r\n                  const spouse = data_stash.find(d => d.id === sp_id)\r\n                  return (`<option value=\"${sp_id}\" ${i === 0 ? 'selected' : ''}>${card_display[0](spouse)}</option>`)\r\n                }).join(\"\\n\")}\r\n          <option value=\"${'_new'}\">NEW</option>\r\n        </select>\r\n      </div>\r\n    `)\r\n  }\r\n\r\n  function submitFormChanges(e) {\r\n   \r\n    e.preventDefault()\r\n    const form_data = new FormData(e.target)\r\n    form_data.forEach((v, k) => datum.data[k] = v)\r\n    close()\r\n    postSubmit()\r\n    \r\n  }\r\n\r\n  function deletePerson() {\r\n    close()\r\n    postSubmit({delete: true})\r\n  }\r\n\r\n  function getEditFields(card_edit) {\r\n    return card_edit.map(d => (\r\n      d.type === 'text'\r\n        ? `<input type=\"text\" name=\"${d.key}\" placeholder=\"${d.placeholder}\" value=\"${datum.data[d.key] || ''}\">`\r\n        : d.type === 'textarea'\r\n        ? `<textarea class=\"materialize-textarea\" name=\"${d.key}\" placeholder=\"${d.placeholder}\">${datum.data[d.key] || ''}</textarea>`\r\n        : ''\r\n    )).join('\\n')\r\n  }\r\n}","//[remove_before_rollup]\r\nimport * as _d3 from 'd3';\r\nexport default typeof window === \"object\" && !!window.d3 ? window.d3 : _d3;","export function sortChildrenWithSpouses(data) {\r\n  data.forEach(datum => {\r\n    if (!datum.rels.children) return\r\n    datum.rels.children.sort((a, b) => {\r\n      const a_d = data.find(d => d.id === a),\r\n        b_d = data.find(d => d.id === b),\r\n        a_p2 = otherParent(a_d, datum, data) || {},\r\n        b_p2 = otherParent(b_d, datum, data) || {},\r\n        a_i = datum.rels.spouses.indexOf(a_p2.id),\r\n        b_i = datum.rels.spouses.indexOf(b_p2.id)\r\n\r\n      if (datum.data.gender === \"M\") return a_i - b_i\r\n      else return b_i - a_i\r\n    })\r\n  })\r\n}\r\n\r\nfunction otherParent(d, p1, data) {\r\n  return data.find(d0 => (d0.id !== p1.id) && ((d0.id === d.rels.mother) || (d0.id === d.rels.father)))\r\n}\r\n\r\nexport function calculateEnterAndExitPositions(d, entering, exiting) {\r\n  d.exiting = exiting\r\n  if (entering) {\r\n    if (d.depth === 0 && !d.spouse) {d._x = d.x; d._y = d.y}\r\n    else if (d.spouse) {d._x = d.spouse.x; d._y = d.spouse.y;}\r\n    else if (d.is_ancestry) {d._x = d.parent.x; d._y = d.parent.y;}\r\n    else {d._x = d.psx; d._y = d.parent.y;}\r\n  } else if (exiting) {\r\n    const x = d.x > 0 ? 1 : -1,\r\n      y = d.y > 0 ? 1 : -1\r\n    {d._x = d.x+400*x; d._y = d.y+400*y;}\r\n  }\r\n}\r\n\r\nexport function toggleRels(tree_datum, hide_rels) {\r\n  const\r\n    rels = hide_rels ? 'rels' : '_rels',\r\n    rels_ = hide_rels ? '_rels' : 'rels'\r\n  \r\n  if (tree_datum.is_ancestry || tree_datum.data.main) {showHideAncestry('father'); showHideAncestry('mother')}\r\n  else {showHideChildren()}\r\n\r\n  function showHideAncestry(rel_type) {\r\n    if (!tree_datum.data[rels] || !tree_datum.data[rels][rel_type]) return\r\n    if (!tree_datum.data[rels_]) tree_datum.data[rels_] = {}\r\n    tree_datum.data[rels_][rel_type] = tree_datum.data[rels][rel_type]\r\n    delete tree_datum.data[rels][rel_type]\r\n  }\r\n\r\n  function showHideChildren() {\r\n    if (!tree_datum.data[rels] || !tree_datum.data[rels].children) return\r\n    const\r\n      children = tree_datum.data[rels].children.slice(0),\r\n      spouses = tree_datum.spouse ? [tree_datum.spouse] : tree_datum.spouses || [];\r\n\r\n    [tree_datum, ...spouses].forEach(sp => children.forEach(ch_id => {\r\n      if (sp.data[rels].children.includes(ch_id)) {\r\n        if (!sp.data[rels_]) sp.data[rels_] = {}\r\n        if (!sp.data[rels_].children) sp.data[rels_].children = []\r\n        sp.data[rels_].children.push(ch_id)\r\n        sp.data[rels].children.splice(sp.data[rels].children.indexOf(ch_id), 1)\r\n      }\r\n    }))\r\n  }\r\n}\r\n\r\nexport function toggleAllRels(tree_data, hide_rels) {\r\n  tree_data.forEach(d => {d.data.hide_rels = hide_rels; toggleRels(d, hide_rels)})\r\n}\r\n\r\n","import d3 from \"../d3.js\"\r\nimport {checkIfRelativesConnectedWithoutPerson} from \"./checkIfRelativesConnectedWithoutPerson.js\"\r\nimport {createTreeDataWithMainNode} from \"./newPerson.js\"\r\n\r\nexport function moveToAddToAdded(datum, data_stash) {\r\n  delete datum.to_add\r\n  return datum\r\n}\r\n\r\nexport function removeToAdd(datum, data_stash) {\r\n  deletePerson(datum, data_stash)\r\n  return false\r\n}\r\n\r\nexport function deletePerson(datum, data_stash) {\r\n  if (!checkIfRelativesConnectedWithoutPerson(datum, data_stash)) return {success: false, error: 'checkIfRelativesConnectedWithoutPerson'}\r\n  executeDelete()\r\n  return {success: true};\r\n\r\n  function executeDelete() {\r\n    data_stash.forEach(d => {\r\n      for (let k in d.rels) {\r\n        if (!d.rels.hasOwnProperty(k)) continue\r\n        if (d.rels[k] === datum.id) {\r\n          delete d.rels[k]\r\n        } else if (Array.isArray(d.rels[k]) && d.rels[k].includes(datum.id)) {\r\n          d.rels[k].splice(d.rels[k].findIndex(did => did === datum.id), 1)\r\n        }\r\n      }\r\n    })\r\n    data_stash.splice(data_stash.findIndex(d => d.id === datum.id), 1)\r\n    data_stash.forEach(d => {if (d.to_add) deletePerson(d, data_stash)})  // full update of tree\r\n    if (data_stash.length === 0) data_stash.push(createTreeDataWithMainNode({}).data[0])\r\n  }\r\n}\r\n\r\nexport function manualZoom({amount, svg, transition_time=500}) {\r\n  const zoom = svg.__zoomObj\r\n  d3.select(svg).transition().duration(transition_time || 0).delay(transition_time ? 100 : 0)  // delay 100 because of weird error of undefined something in d3 zoom\r\n    .call(zoom.scaleBy, amount)\r\n}\r\n\r\nexport function isAllRelativeDisplayed(d, data) {\r\n  const r = d.data.rels,\r\n    all_rels = [r.father, r.mother, ...(r.spouses || []), ...(r.children || [])].filter(v => v)\r\n  return all_rels.every(rel_id => data.some(d => d.data.id === rel_id))\r\n}\r\n\r\nexport function generateUUID() {\r\n  var d = new Date().getTime();\r\n  var d2 = (performance && performance.now && (performance.now()*1000)) || 0;//Time in microseconds since page-load or 0 if unsupported\r\n  return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {\r\n    var r = Math.random() * 16;\r\n    if(d > 0){//Use timestamp until depleted\r\n      r = (d + r)%16 | 0;\r\n      d = Math.floor(d/16);\r\n    } else {//Use microseconds since page-load if supported\r\n      r = (d2 + r)%16 | 0;\r\n      d2 = Math.floor(d2/16);\r\n    }\r\n    return (c === 'x' ? r : (r & 0x3 | 0x8)).toString(16);\r\n  });\r\n}\r\n","import {generateUUID, removeToAdd} from \"./general.js\";\r\n\r\nexport function handleRelsOfNewDatum({datum, data_stash, rel_type, rel_datum}) {\r\n  if (rel_type === \"daughter\" || rel_type === \"son\") addChild(datum)\r\n  else if (rel_type === \"father\" || rel_type === \"mother\") addParent(datum)\r\n  else if (rel_type === \"spouse\") addSpouse(datum)\r\n\r\n  function addChild(datum) {\r\n    if (datum.data.other_parent) {\r\n      addChildToSpouseAndParentToChild(datum.data.other_parent)\r\n      delete datum.data.other_parent\r\n    }\r\n    datum.rels[rel_datum.data.gender === 'M' ? 'father' : 'mother'] = rel_datum.id\r\n    if (!rel_datum.rels.children) rel_datum.rels.children = []\r\n    rel_datum.rels.children.push(datum.id)\r\n    return datum\r\n\r\n    function addChildToSpouseAndParentToChild(spouse_id) {\r\n      if (spouse_id === \"_new\") spouse_id = addOtherParent().id;\r\n\r\n      const spouse = data_stash.find(d => d.id === spouse_id)\r\n      datum.rels[spouse.data.gender === 'M' ? 'father' : 'mother'] = spouse.id\r\n      if (!spouse.rels.hasOwnProperty('children')) spouse.rels.children = []\r\n      spouse.rels.children.push(datum.id)\r\n\r\n      function addOtherParent() {\r\n        const new_spouse = createNewPersonWithGenderFromRel({rel_type: \"spouse\", rel_datum})\r\n        addSpouse(new_spouse)\r\n        addNewPerson({data_stash, datum: new_spouse})\r\n        return new_spouse\r\n      }\r\n    }\r\n  }\r\n\r\n  function addParent(datum) {\r\n    const is_father = datum.data.gender === \"M\",\r\n      parent_to_add_id = rel_datum.rels[is_father ? 'father' : 'mother'];\r\n    if (parent_to_add_id) removeToAdd(data_stash.find(d => d.id === parent_to_add_id), data_stash)\r\n    addNewParent()\r\n\r\n    function addNewParent() {\r\n      rel_datum.rels[is_father ? 'father' : 'mother'] = datum.id\r\n      handleSpouse()\r\n      datum.rels.children = [rel_datum.id]\r\n      return datum\r\n\r\n      function handleSpouse() {\r\n        const spouse_id = rel_datum.rels[!is_father ? 'father' : 'mother']\r\n        if (!spouse_id) return\r\n        const spouse = data_stash.find(d => d.id === spouse_id)\r\n        datum.rels.spouses = [spouse_id]\r\n        if (!spouse.rels.spouses) spouse.rels.spouses = []\r\n        spouse.rels.spouses.push(datum.id)\r\n        return spouse\r\n      }\r\n    }\r\n  }\r\n\r\n  function addSpouse(datum) {\r\n    removeIfToAdd();\r\n    if (!rel_datum.rels.spouses) rel_datum.rels.spouses = []\r\n    rel_datum.rels.spouses.push(datum.id);\r\n    datum.rels.spouses = [rel_datum.id];\r\n\r\n    function removeIfToAdd() {\r\n      if (!rel_datum.rels.spouses) return\r\n      rel_datum.rels.spouses.forEach(spouse_id => {\r\n        const spouse = data_stash.find(d => d.id === spouse_id);\r\n        if (spouse.to_add) removeToAdd(spouse, data_stash)\r\n      })\r\n    }\r\n  }\r\n}\r\n\r\nexport function createNewPerson({data, rels}) {\r\n  return {id: generateUUID(), data: data || {}, rels: rels || {}}\r\n}\r\n\r\nexport function createNewPersonWithGenderFromRel({data, rel_type, rel_datum}) {\r\n  const gender = getGenderFromRelative(rel_datum, rel_type)\r\n  data = Object.assign(data || {}, {gender})\r\n  return createNewPerson({data})\r\n\r\n  function getGenderFromRelative(rel_datum, rel_type) {\r\n    return ([\"daughter\", \"mother\"].includes(rel_type) || rel_type === \"spouse\" && rel_datum.data.gender === \"M\") ? \"F\" : \"M\"\r\n  }\r\n}\r\n\r\nexport function addNewPerson({data_stash, datum}) {\r\n  data_stash.push(datum)\r\n}\r\n\r\nexport function createTreeDataWithMainNode({data, version}) {\r\n  return {data: [createNewPerson({data})], version}\r\n}\r\n\r\nexport function addNewPersonAndHandleRels({datum, data_stash, rel_type, rel_datum}) {\r\n  addNewPerson({data_stash, datum})\r\n  handleRelsOfNewDatum({datum, data_stash, rel_type, rel_datum})\r\n}\r\n","import d3 from \"../d3.js\"\r\nimport {sortChildrenWithSpouses} from \"./CalculateTree.handlers.js\"\r\nimport {createNewPerson} from \"../handlers/newPerson.js\"\r\n\r\nexport default function CalculateTree({data_stash, main_id=null, is_vertical=true, node_separation=250, level_separation=150}) {\r\n  data_stash = createRelsToAdd(data_stash)\r\n  sortChildrenWithSpouses(data_stash)\r\n  const main = main_id !== null ? data_stash.find(d => d.id === main_id) : data_stash[0],\r\n    tree_children = calculateTreePositions(main, 'children', false),\r\n    tree_parents = calculateTreePositions(main, 'parents', true)\r\n\r\n  data_stash.forEach(d => d.main = d === main)\r\n  levelOutEachSide(tree_parents, tree_children)\r\n  const tree = mergeSides(tree_parents, tree_children)\r\n  setupChildrenAndParents({tree})\r\n  setupSpouses({tree, node_separation})\r\n  nodePositioning({tree, is_vertical})\r\n\r\n  const dim = calculateTreeDim(tree, node_separation, level_separation, is_vertical)\r\n\r\n  return {data: tree, data_stash, dim}\r\n\r\n  function calculateTreePositions(datum, rt, is_ancestry) {\r\n    const hierarchyGetter = rt === \"children\" ? hierarchyGetterChildren : hierarchyGetterParents,\r\n      d3_tree = d3.tree().nodeSize([node_separation, level_separation]).separation(separation),\r\n      root = d3.hierarchy(datum, hierarchyGetter);\r\n    d3_tree(root);\r\n    return root.descendants()\r\n\r\n    function separation(a, b) {\r\n      let offset = 1;\r\n      if (!is_ancestry) {\r\n        if (!sameParent(a, b)) offset+=.25\r\n        if (someSpouses(a,b)) offset+=offsetOnPartners(a,b)\r\n        if (sameParent(a, b) && !sameBothParents(a,b)) offset+=.125\r\n      }\r\n      return offset\r\n    }\r\n\r\n    function hasCh(d) {return !!d.children}\r\n    function sameParent(a, b) {return a.parent == b.parent}\r\n    function sameBothParents(a, b) {return (a.data.rels.father === b.data.rels.father) && (a.data.rels.mother === b.data.rels.mother)}\r\n    function someChildren(a, b) {return hasCh(a) || hasCh(b)}\r\n    function hasSpouses(d) {return d.data.rels.spouses && d.data.rels.spouses.length > 0}\r\n    function someSpouses(a, b) {return hasSpouses(a) || hasSpouses(b)}\r\n\r\n    function hierarchyGetterChildren(d) {\r\n      return [...(d.rels.children || [])].map(id => data_stash.find(d => d.id === id))\r\n    }\r\n\r\n    function hierarchyGetterParents(d) {\r\n      return [d.rels.father, d.rels.mother]\r\n        .filter(d => d).map(id => data_stash.find(d => d.id === id))\r\n    }\r\n\r\n    function offsetOnPartners(a,b) {\r\n      return (Math.max((a.data.rels.spouses || []).length, (b.data.rels.spouses || []).length))*.5+.5\r\n    }\r\n  }\r\n\r\n  function levelOutEachSide(parents, children) {\r\n    const mid_diff = (parents[0].x - children[0].x) / 2\r\n    parents.forEach(d => d.x-=mid_diff)\r\n    children.forEach(d => d.x+=mid_diff)\r\n  }\r\n\r\n  function mergeSides(parents, children) {\r\n    parents.forEach(d => {d.is_ancestry = true})\r\n    parents.forEach(d => d.depth === 1 ? d.parent = children[0] : null)\r\n\r\n    return [...children, ...parents.slice(1)];\r\n  }\r\n  function nodePositioning({tree, is_vertical}) {\r\n    tree.forEach(d => {\r\n      d.y *= (d.is_ancestry ? -1 : 1)\r\n      if (!is_vertical) {\r\n        const d_x = d.x; d.x = d.y; d.y = d_x\r\n      }\r\n    })\r\n  }\r\n\r\n  function setupSpouses({tree, node_separation}) {\r\n    for (let i = tree.length; i--;) {\r\n      const d = tree[i]\r\n      if (!d.is_ancestry && d.data.rels.spouses && d.data.rels.spouses.length > 0){\r\n        const side = d.data.data.gender === \"M\" ? -1 : 1;  // female on right\r\n        d.x += d.data.rels.spouses.length/2*node_separation*side;\r\n        d.data.rels.spouses.forEach((sp_id, i) => {\r\n          const spouse = {data: data_stash.find(d0 => d0.id === sp_id), added: true}\r\n\r\n          spouse.x = d.x-(node_separation*(i+1))*side;\r\n          spouse.y = d.y\r\n          spouse.sx = i > 0 ? spouse.x : spouse.x + (node_separation/2)*side\r\n          spouse.depth = d.depth;\r\n          spouse.spouse = d;\r\n          if (!d.spouses) d.spouses = []\r\n          d.spouses.push(spouse)\r\n          tree.push(spouse)\r\n\r\n          tree.forEach(d0 => (\r\n            (d0.data.rels.father === d.data.id && d0.data.rels.mother === spouse.data.id) ||\r\n            (d0.data.rels.mother === d.data.id && d0.data.rels.father === spouse.data.id)\r\n            ) ? d0.psx = spouse.sx : null\r\n          )\r\n        })\r\n      }\r\n      if (d.parents && d.parents.length === 2) {\r\n        const p1 = d.parents[0],\r\n          p2 = d.parents[1],\r\n          midd = p1.x - (p1.x - p2.x)/2,\r\n          x = (d,sp) => midd + (node_separation/2)*(d.x < sp.x ? 1 : -1)\r\n\r\n        p2.x = x(p1, p2); p1.x = x(p2, p1)\r\n      }\r\n    }\r\n  }\r\n\r\n  function setupChildrenAndParents({tree}) {\r\n    tree.forEach(d0 => {\r\n      delete d0.children\r\n      tree.forEach(d1 => {\r\n        if (d1.parent === d0) {\r\n          if (d1.is_ancestry) {\r\n            if (!d0.parents) d0.parents = []\r\n            d0.parents.push(d1)\r\n          } else {\r\n            if (!d0.children) d0.children = []\r\n            d0.children.push(d1)\r\n          }\r\n        }\r\n      })\r\n    })\r\n  }\r\n\r\n  function calculateTreeDim(tree, node_separation, level_separation, is_vertical) {\r\n    if (!is_vertical) [node_separation, level_separation] = [level_separation, node_separation]\r\n    const w_extent = d3.extent(tree, d => d.x),\r\n      h_extent = d3.extent(tree, d => d.y)\r\n    return {\r\n      width: w_extent[1] - w_extent[0]+node_separation, height: h_extent[1] - h_extent[0]+level_separation, x_off: -w_extent[0]+node_separation/2, y_off: -h_extent[0]+level_separation/2\r\n    }\r\n  }\r\n\r\n  function createRelsToAdd(data) {\r\n    const to_add_spouses = [];\r\n    for (let i = 0; i < data.length; i++) {\r\n      const d = data[i];\r\n      if (d.rels.children && d.rels.children.length > 0) {\r\n        if (!d.rels.spouses) d.rels.spouses = []\r\n        const is_father = d.data.gender === \"M\"\r\n        let spouse\r\n\r\n        d.rels.children.forEach(d0 => {\r\n          const child = data.find(d1 => d1.id === d0)\r\n          if (child.rels[is_father ? 'father' : 'mother'] !== d.id) return\r\n          if (child.rels[!is_father ? 'father' : 'mother']) return\r\n          if (!spouse) {\r\n            spouse = createToAddSpouse(d)\r\n            d.rels.spouses.push(spouse.id)\r\n          }\r\n          spouse.rels.children.push(child.id)\r\n          child.rels[!is_father ? 'father' : 'mother'] = spouse.id\r\n        })\r\n      }\r\n    }\r\n    to_add_spouses.forEach(d => data.push(d))\r\n    return data\r\n\r\n    function createToAddSpouse(d) {\r\n      const spouse = createNewPerson({\r\n        data: {gender: d.data.gender === \"M\" ? \"F\" : \"M\"},\r\n        rels: {spouses: [d.id], children: []}\r\n      });\r\n      spouse.to_add = true;\r\n      to_add_spouses.push(spouse);\r\n      return spouse\r\n    }\r\n  }\r\n\r\n}\r\n","import CalculateTree from \"./CalculateTree/CalculateTree.js\"\r\nimport {createTreeDataWithMainNode} from \"./handlers/newPerson.js\"\r\nimport dataJson from './data.json';\r\nconst fs = require('fs');\r\n\r\nexport default function createStore(initial_state) {\r\n  let onUpdate;\r\n  const state = initial_state,\r\n    update = {\r\n      tree: (props) => {\r\n        state.tree = calcTree();\r\n        if (onUpdate) onUpdate(props)\r\n      },\r\n      mainId: main_id => state.main_id = main_id,\r\n      data: data => state.data = data\r\n    },\r\n    getData = () => state.data,\r\n    getTree = () => state.tree,\r\n    setOnUpdate = (f) => onUpdate = f,\r\n    methods = {}\r\n\r\n  return {state, update, getData, getTree, setOnUpdate, methods}\r\n\r\n\r\n  function calcTree() {\r\n    console.log(\"This is it\",state.data)\r\n    localStorage.setItem('treeData', JSON.stringify(state.data));\r\n\r\n    return CalculateTree({\r\n      data_stash: state.data, main_id: state.main_id,\r\n      node_separation: state.node_separation, level_separation: state.level_separation\r\n    })\r\n  }\r\n}","import React from \"react\";\r\nimport f3 from \"family-chart\"; // npm i family-chart\r\nimport \"./family-chart.css\"; // create file 'family-chart.css' in same directory, copy/paste css from examples/create-tree\r\nimport M from \"materialize-css\";\r\nimport { Form } from \"./view/elements/Form.js\"\r\nimport axios from 'axios';\r\nimport dataJson from './data.json';\r\nimport * as d3 from \"d3\";\r\n\r\nimport createStore from \"./createStore\";\r\n\r\n\r\n\r\nexport default class FamilyTree extends React.Component {\r\n\r\n  constructor(props) {\r\n    super(props);\r\n    this.chartRef = React.createRef();\r\n    this.contRef = React.createRef();\r\n    this.handleF3 = this.handleF3.bind(this);\r\n    this.state = {\r\n      chartState: null,\r\n    };\r\n  }\r\n\r\n  // contRef = React.createRef();\r\n\r\n  componentDidMount() {\r\n    if (!this.contRef.current) return;\r\n\r\n    let dataTree = dataJson\r\n    let localTree = localStorage.getItem('treeData')\r\n    if (localTree === null) {\r\n      \r\n      console.log(\"NOt retain\")\r\n      localStorage.setItem('treeData', JSON.stringify(dataJson));\r\n    } else {\r\n      console.log(\"reteain\")\r\n      dataTree = localStorage.getItem('treeData');\r\n      dataTree = JSON.parse(dataTree)\r\n    }\r\n\r\n    initProcess()\r\n    // axios.get('/src/data.json')\r\n    //   .then(response =>  console.log(\"response\", response))\r\n    //   .catch(error => console.error(error));\r\n\r\n    // fetch(\"/app/familyChart/data.json\").then(r => {\r\n    //   console.log(\"r\", r)\r\n    //   r.json()}).then(data => {\r\n    //   console.log(\"dataExt\", data)\r\n    //   initProcess(data)\r\n    // })\r\n\r\n\r\n    function initProcess() {\r\n      const cont = document.querySelector(\"#chart\")\r\n\r\n\r\n\r\n      const card_dim = { w: 220, h: 70, text_x: 75, text_y: 15, img_w: 60, img_h: 60, img_x: 5, img_y: 5 }\r\n      const card_display = cardDisplay();\r\n      const card_edit = cardEditParams();\r\n      // const store = f3.createStore({\r\n      const store = createStore({\r\n        data: dataTree,\r\n        card_display: [d => d.data.label || '', d => d.data.desc || ''],\r\n        mini_tree: true,\r\n        hide_rels: true,\r\n        node_separation: 250,\r\n        level_separation: 150,\r\n        custom_elements: [{ el: customAddBtn(card_dim), lis: customAddBtnListener, query: \".customAddBtn\" }],\r\n        card_dim\r\n      }),\r\n        view = f3.d3AnimationView({\r\n          store,\r\n          cont: document.querySelector(\"#chart\"),\r\n          card_edit\r\n        }),\r\n        Card = f3.elements.Card({\r\n          store,\r\n          svg: view.svg,\r\n          card_dim: {\r\n            w: 220,\r\n            h: 70,\r\n            text_x: 75,\r\n            text_y: 15,\r\n            img_w: 60,\r\n            img_h: 60,\r\n            img_x: 5,\r\n            img_y: 5\r\n          },\r\n          card_display: [\r\n            (d) => `${d.data[\"first name\"] || \"\"} ${d.data[\"last name\"] || \"\"}`,\r\n            (d) => `${d.data[\"birthday\"] || \"\"}`\r\n          ],\r\n          cardEditForm,\r\n          addRelative: f3.handlers.AddRelative({ store, cont, card_dim, cardEditForm, labels: { mother: 'Add mother' } }),\r\n          mini_tree: true,\r\n          link_break: false\r\n        });\r\n\r\n      view.setCard(Card);\r\n      store.setOnUpdate((props) => view.update(props || {}));\r\n      store.update.tree({ initial: true });\r\n      console.log(\"store\", store)\r\n      // function data() {\r\n      //   return [\r\n      //     {\r\n      //       id: \"0\",\r\n      //       rels: {\r\n      //         spouses: null,\r\n      //         father: null,\r\n      //         mother: null,\r\n      //         children: null\r\n      //       },\r\n      //       data: {\r\n      //         \"first name\": \"Agnus\",\r\n      //         \"last name\": \"\",\r\n      //         birthday: \"1970\",\r\n      //         avatar:\r\n      //           \"https://static8.depositphotos.com/1009634/988/v/950/depositphotos_9883921-stock-illustration-no-user-profile-picture.jpg\",\r\n      //         gender: \"M\"\r\n      //       }\r\n      //     },\r\n\r\n      //   ];\r\n      // }\r\n\r\n      function cardEditForm(props) {\r\n        const postSubmit = props.postSubmit;\r\n        props.postSubmit = (ps_props) => {\r\n          postSubmit(ps_props)\r\n          console.log(\"ps_props\", postSubmit)\r\n        }\r\n        const el = document.querySelector('#form_modal'),\r\n          modal = M.Modal.getInstance(el),\r\n          edit = { el, open: () => modal.open(), close: () => modal.close() }\r\n        Form({ ...props, card_edit, card_display, edit })\r\n      }\r\n\r\n      function cardDisplay() {\r\n        const d1 = d => `${d.data['first name'] || ''} ${d.data['last name'] || ''}`,\r\n          d2 = d => `${d.data['birthday'] || ''}`\r\n        d1.create_form = \"{first name} {last name}\"\r\n        d2.create_form = \"{birthday}\"\r\n\r\n        return [d1, d2]\r\n      }\r\n\r\n\r\n      function cardEditParams() {\r\n        return [\r\n          { type: 'text', placeholder: 'first name', key: 'first name' },\r\n          { type: 'text', placeholder: 'last name', key: 'last name' },\r\n          { type: 'text', placeholder: 'birthday', key: 'birthday' },\r\n          { type: 'text', placeholder: 'avatar', key: 'avatar' }\r\n        ]\r\n      }\r\n\r\n      const modal = document.body.appendChild(document.createElement(\"div\"));\r\n      modal.setAttribute(\"id\", \"form_modal\");\r\n      modal.setAttribute(\"class\", \"modal\");\r\n      M.Modal.init(modal);\r\n\r\n\r\n\r\n    }\r\n  }\r\n\r\n  handleF3() {\r\n    const chartElement = document.getElementById('chart');\r\n\r\n    // Get the chart instance from the element reference\r\n    const chartInstance = chartElement.chartInstance;\r\n\r\n    // Get the current data state of the chart\r\n    // const dataState = chartInstance.getData();\r\n\r\n\r\n  }\r\n\r\n\r\n\r\n  render() {\r\n\r\n\r\n\r\n    return (\r\n    <div style={{ display: 'flex',justifyContent: 'flex-start',maxWidth: '100%',  margin: 'auto' }}>\r\n      <div className=\"row\">\r\n        {/* <div className=\"col s12 m9\" ref={this.chartRef}> */}\r\n          <div className=\"f3\" id=\"chart\" ref={this.contRef} style={{ position: 'relative' }}>\r\n          </div>\r\n        {/* </div> */}\r\n        \r\n      </div>\r\n      <div id=\"form_data\" className=\"modal\">\r\n      </div>\r\n    </div>)\r\n  }\r\n}\r\n\r\nfunction customAddBtn(card_dim) {\r\n  return (`\r\n    <g class=\"customAddBtn\" style=\"cursor: pointer\">\r\n      <g transform=\"translate(${card_dim.w - 12},${card_dim.h - 12})scale(.08)\">\r\n        <circle r=\"100\" fill=\"#fff\" />\r\n        <g transform=\"translate(-50,-45)\">\r\n          <line\r\n            x1=\"10\" x2=\"90\" y1=\"50\" y2=\"50\"\r\n            stroke=\"currentColor\" stroke-width=\"20\" stroke-linecap=\"round\"\r\n          />\r\n          <line\r\n            x1=\"50\" x2=\"50\" y1=\"10\" y2=\"90\"\r\n            stroke=\"currentColor\" stroke-width=\"20\" stroke-linecap=\"round\"\r\n          />\r\n        </g>\r\n      </g>\r\n    </g>\r\n  `)\r\n}\r\n\r\nfunction customAddBtnListener(store, props) {\r\n  console.log(props.card)\r\n  console.log(props.d)\r\n}\r\n","import React from \"react\";\r\nimport FamilyTree from \"./app/familyChart/FamilyChartActions\";\r\nimport 'materialize-css/dist/css/materialize.min.css'\r\n// import FamilyComp from \"./app/familyChartComp\";\r\n\r\n\r\nexport default function App() {\r\n  return (\r\n    <div className=\"App\" style={{width: '100%'}}>\r\n      <FamilyTree/>\r\n      {/* <FamilyComp/> */}\r\n    </div>\r\n  );\r\n}\r\n","import React from \"react\";\r\nimport ReactDOM from \"react-dom\";\r\n\r\nimport App from \"./App\";\r\n\r\nconst rootElement = document.getElementById(\"root\");\r\nReactDOM.render(\r\n  <React.StrictMode>\r\n    <App />\r\n  </React.StrictMode>,\r\n  rootElement\r\n);\r\n"],"sourceRoot":""}