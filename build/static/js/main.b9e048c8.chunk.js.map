{"version":3,"sources":["app/familyChart/view/elements/Form.js","app/familyChart/FamilyChartActions.js","App.js","index.js"],"names":["Form","_ref","datum","rel_datum","store","rel_type","card_edit","postSubmit","card_display","_ref$edit","edit","el","open","close","submitFormChanges","e","console","log","preventDefault","FormData","target","forEach","v","k","data","deletePerson","delete","innerHTML","concat","to_add","gender","map","d","type","key","placeholder","join","getEditFields","data_stash","getData","rels","spouses","length","sp_id","i","spouse","find","id","otherParentSelect","querySelector","addEventListener","FamilyTree","_React$Component","_inherits","_super","_createSuper","props","_this","_classCallCheck","call","chartRef","React","createRef","contRef","handleF3","bind","_assertThisInitialized","state","chartState","_createClass","value","this","current","cont","document","card_dim","w","h","text_x","text_y","img_w","img_h","img_x","img_y","d1","d2","create_form","cardDisplay","f3","createStore","dataJson","label","desc","mini_tree","hide_rels","node_separation","level_separation","custom_elements","customAddBtn","lis","customAddBtnListener","query","view","d3AnimationView","Card","elements","svg","cardEditForm","addRelative","handlers","AddRelative","labels","mother","link_break","ps_props","modal","M","Modal","getInstance","_objectSpread","setCard","setOnUpdate","update","tree","initial","body","appendChild","createElement","setAttribute","init","chart","FamilyChart","initProcess","getState","style","maxWidth","margin","className","ref","position","onClick","Component","card","App","rootElement","getElementById","ReactDOM","render","StrictMode"],"mappings":"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","file":"static/js/main.b9e048c8.chunk.js","sourcesContent":["\r\n\r\n\r\nexport function Form({datum, rel_datum, store, rel_type, card_edit, postSubmit, card_display, edit: {el, open, close}}) {\r\n  setupFromHtml();\r\n  open();\r\n\r\n  function setupFromHtml() {\r\n    el.innerHTML = (`\r\n      <div class=\"modal-content\">\r\n        <form>\r\n          <div>\r\n            <div style=\"text-align: left\">\r\n              <span style=\"display: ${datum.to_add || !!rel_datum ? 'none' : null}; float: right; cursor: pointer\" class=\"red-text delete\">delete</span>\r\n            </div>\r\n            <div>\r\n              <label><input type=\"radio\" name=\"gender\" value=\"M\" ${datum.data.gender === 'M' ? 'checked' : ''}><span>male</span></label><br>\r\n              <label><input type=\"radio\" name=\"gender\" value=\"F\" ${datum.data.gender === 'F' ? 'checked' : ''}><span>female</span></label><br>\r\n            </div>\r\n          </div>\r\n          ${getEditFields(card_edit)}\r\n          ${(rel_type === \"son\" || rel_type === \"daughter\") ? otherParentSelect() : ''}\r\n          <br><br>\r\n          <div style=\"text-align: center\">\r\n            <button type=\"submit\" class=\"btn\">submit</button>\r\n          </div>\r\n        </form>\r\n      </div>\r\n    `)\r\n    el.querySelector(\"form\").addEventListener('submit', submitFormChanges)\r\n    el.querySelector(\".delete\").addEventListener('click', deletePerson)\r\n  }\r\n\r\n  function otherParentSelect() {\r\n    const data_stash = store.getData();\r\n    return (`\r\n      <div>\r\n        <label>Select other</label>\r\n        <select name=\"other_parent\" style=\"display: block\">\r\n          ${(!rel_datum.rels.spouses || rel_datum.rels.spouses.length === 0) \r\n              ? '' \r\n              : rel_datum.rels.spouses.map((sp_id, i) => {\r\n                  const spouse = data_stash.find(d => d.id === sp_id)\r\n                  return (`<option value=\"${sp_id}\" ${i === 0 ? 'selected' : ''}>${card_display[0](spouse)}</option>`)\r\n                }).join(\"\\n\")}\r\n          <option value=\"${'_new'}\">NEW</option>\r\n        </select>\r\n      </div>\r\n    `)\r\n  }\r\n\r\n  function submitFormChanges(e) {\r\n    console.log(\"update\")\r\n    e.preventDefault()\r\n    const form_data = new FormData(e.target)\r\n    form_data.forEach((v, k) => datum.data[k] = v)\r\n\r\n    close()\r\n    postSubmit()\r\n  }\r\n\r\n  function deletePerson() {\r\n    close()\r\n    postSubmit({delete: true})\r\n  }\r\n\r\n  function getEditFields(card_edit) {\r\n    return card_edit.map(d => (\r\n      d.type === 'text'\r\n        ? `<input type=\"text\" name=\"${d.key}\" placeholder=\"${d.placeholder}\" value=\"${datum.data[d.key] || ''}\">`\r\n        : d.type === 'textarea'\r\n        ? `<textarea class=\"materialize-textarea\" name=\"${d.key}\" placeholder=\"${d.placeholder}\">${datum.data[d.key] || ''}</textarea>`\r\n        : ''\r\n    )).join('\\n')\r\n  }\r\n}","import React from \"react\";\r\nimport f3 from \"family-chart\"; // npm i family-chart\r\nimport \"./family-chart.css\"; // create file 'family-chart.css' in same directory, copy/paste css from examples/create-tree\r\nimport M from \"materialize-css\";\r\nimport { Form } from \"./view/elements/Form.js\"\r\nimport axios from 'axios';\r\nimport dataJson from './data.json';\r\nimport FamilyChart from 'family-chart';\r\n// import createStore from \"./createStore\";\r\n\r\n\r\n\r\nexport default class FamilyTree extends React.Component {\r\n\r\n  constructor(props) {\r\n    super(props);\r\n    this.chartRef = React.createRef();\r\n    this.contRef = React.createRef();\r\n    this.handleF3 = this.handleF3.bind(this);\r\n    this.state = {\r\n      chartState: null,\r\n    };\r\n  }\r\n\r\n  // contRef = React.createRef();\r\n\r\n  componentDidMount() {\r\n    if (!this.contRef.current) return;\r\n    initProcess()\r\n    // axios.get('/src/data.json')\r\n    //   .then(response =>  console.log(\"response\", response))\r\n    //   .catch(error => console.error(error));\r\n\r\n    // fetch(\"/app/familyChart/data.json\").then(r => {\r\n    //   console.log(\"r\", r)\r\n    //   r.json()}).then(data => {\r\n    //   console.log(\"dataExt\", data)\r\n    //   initProcess(data)\r\n    // })\r\n\r\n\r\n    function initProcess() {\r\n      const cont = document.querySelector(\"#chart\")\r\n\r\n\r\n\r\n      const card_dim = { w: 220, h: 70, text_x: 75, text_y: 15, img_w: 60, img_h: 60, img_x: 5, img_y: 5 }\r\n      const card_display = cardDisplay();\r\n      const card_edit = cardEditParams();\r\n      const store = f3.createStore({\r\n      // const store = createStore({\r\n        data: dataJson,\r\n        card_display: [d => d.data.label || '', d => d.data.desc || ''],\r\n        mini_tree: true,\r\n        hide_rels: true,\r\n        node_separation: 250,\r\n        level_separation: 150,\r\n        custom_elements: [{ el: customAddBtn(card_dim), lis: customAddBtnListener, query: \".customAddBtn\" }],\r\n        card_dim\r\n      }),\r\n        view = f3.d3AnimationView({\r\n          store,\r\n          cont: document.querySelector(\"#chart\"),\r\n          card_edit\r\n        }),\r\n        Card = f3.elements.Card({\r\n          store,\r\n          svg: view.svg,\r\n          card_dim: {\r\n            w: 220,\r\n            h: 70,\r\n            text_x: 75,\r\n            text_y: 15,\r\n            img_w: 60,\r\n            img_h: 60,\r\n            img_x: 5,\r\n            img_y: 5\r\n          },\r\n          card_display: [\r\n            (d) => `${d.data[\"first name\"] || \"\"} ${d.data[\"last name\"] || \"\"}`,\r\n            (d) => `${d.data[\"birthday\"] || \"\"}`\r\n          ],\r\n          cardEditForm,\r\n          addRelative: f3.handlers.AddRelative({ store, cont, card_dim, cardEditForm, labels: { mother: 'Add mother' } }),\r\n          mini_tree: true,\r\n          link_break: false\r\n        });\r\n\r\n      view.setCard(Card);\r\n      store.setOnUpdate((props) => view.update(props || {}));\r\n      store.update.tree({ initial: true });\r\n      console.log(\"store\", store)\r\n      // function data() {\r\n      //   return [\r\n      //     {\r\n      //       id: \"0\",\r\n      //       rels: {\r\n      //         spouses: null,\r\n      //         father: null,\r\n      //         mother: null,\r\n      //         children: null\r\n      //       },\r\n      //       data: {\r\n      //         \"first name\": \"Agnus\",\r\n      //         \"last name\": \"\",\r\n      //         birthday: \"1970\",\r\n      //         avatar:\r\n      //           \"https://static8.depositphotos.com/1009634/988/v/950/depositphotos_9883921-stock-illustration-no-user-profile-picture.jpg\",\r\n      //         gender: \"M\"\r\n      //       }\r\n      //     },\r\n\r\n      //   ];\r\n      // }\r\n\r\n      function cardEditForm(props) {\r\n        const postSubmit = props.postSubmit;\r\n        props.postSubmit = (ps_props) => { postSubmit(ps_props) }\r\n        const el = document.querySelector('#form_modal'),\r\n          modal = M.Modal.getInstance(el),\r\n          edit = { el, open: () => modal.open(), close: () => modal.close() }\r\n        Form({ ...props, card_edit, card_display, edit })\r\n      }\r\n\r\n      function cardDisplay() {\r\n        const d1 = d => `${d.data['first name'] || ''} ${d.data['last name'] || ''}`,\r\n          d2 = d => `${d.data['birthday'] || ''}`\r\n        d1.create_form = \"{first name} {last name}\"\r\n        d2.create_form = \"{birthday}\"\r\n\r\n        return [d1, d2]\r\n      }\r\n\r\n\r\n      function cardEditParams() {\r\n        return [\r\n          { type: 'text', placeholder: 'first name', key: 'first name' },\r\n          { type: 'text', placeholder: 'last name', key: 'last name' },\r\n          { type: 'text', placeholder: 'birthday', key: 'birthday' },\r\n          { type: 'text', placeholder: 'avatar', key: 'avatar' }\r\n        ]\r\n      }\r\n\r\n      const modal = document.body.appendChild(document.createElement(\"div\"));\r\n      modal.setAttribute(\"id\", \"form_modal\");\r\n      modal.setAttribute(\"class\", \"modal\");\r\n      M.Modal.init(modal);\r\n\r\n      this.chart = new FamilyChart(this.contRef.current);\r\n     \r\n    }\r\n  }\r\n\r\n  handleF3() {\r\n    // console.log(\"NEW\"); \r\n    // var chart = new familyChart(document.getElementById('chart'));\r\n    // console.log(\"chart\", chart); \r\n    // const chart = this.chartRef.current.chart;\r\n    // if (chart) {\r\n    //   const updatedData = chart.getData();\r\n    //   console.log(updatedData); // This will log the updated JSON data\r\n    // }\r\n\r\n    const chartState = this.chart.getState();\r\n    console.log(\"chartState\", chartState)\r\n  }\r\n\r\n\r\n\r\n  render() {\r\n\r\n\r\n\r\n    return <div style={{ maxWidth: '1100px', margin: 'auto' }}>\r\n      <div className=\"row\">\r\n        <div className=\"col s12 m9\" ref={this.chartRef}>\r\n          <div className=\"f3\" id=\"chart\" ref={this.contRef} style={{ position: 'relative' }}>\r\n           \r\n          </div>\r\n         \r\n        </div>\r\n        <div className=\"col s12 m3\">\r\n          <div id=\"edit_cont\" className=\"card p5\"></div>\r\n        </div>\r\n      </div>\r\n      <div id=\"form_data\" className=\"modal\">\r\n     \r\n      </div>\r\n      <button onClick={this.handleF3}>get data</button>\r\n      \r\n    </div>\r\n  }\r\n}\r\n\r\nfunction customAddBtn(card_dim) {\r\n  return (`\r\n    <g class=\"customAddBtn\" style=\"cursor: pointer\">\r\n      <g transform=\"translate(${card_dim.w - 12},${card_dim.h - 12})scale(.08)\">\r\n        <circle r=\"100\" fill=\"#fff\" />\r\n        <g transform=\"translate(-50,-45)\">\r\n          <line\r\n            x1=\"10\" x2=\"90\" y1=\"50\" y2=\"50\"\r\n            stroke=\"currentColor\" stroke-width=\"20\" stroke-linecap=\"round\"\r\n          />\r\n          <line\r\n            x1=\"50\" x2=\"50\" y1=\"10\" y2=\"90\"\r\n            stroke=\"currentColor\" stroke-width=\"20\" stroke-linecap=\"round\"\r\n          />\r\n        </g>\r\n      </g>\r\n    </g>\r\n  `)\r\n}\r\n\r\nfunction customAddBtnListener(store, props) {\r\n  console.log(props.card)\r\n  console.log(props.d)\r\n}\r\n","import React from \"react\";\r\nimport FamilyTree from \"./app/familyChart/FamilyChartActions\";\r\nimport 'materialize-css/dist/css/materialize.min.css'\r\n// import FamilyComp from \"./app/familyChartComp\";\r\n\r\n\r\nexport default function App() {\r\n  return (\r\n    <div className=\"App\">\r\n      <FamilyTree/>\r\n      {/* <FamilyComp/> */}\r\n    </div>\r\n  );\r\n}\r\n","import React from \"react\";\r\nimport ReactDOM from \"react-dom\";\r\n\r\nimport App from \"./App\";\r\n\r\nconst rootElement = document.getElementById(\"root\");\r\nReactDOM.render(\r\n  <React.StrictMode>\r\n    <App />\r\n  </React.StrictMode>,\r\n  rootElement\r\n);\r\n"],"sourceRoot":""}